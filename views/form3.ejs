<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Form 3 - RSVP Application</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons" />
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Roboto', sans-serif;
        }
    </style>
</head>
<body class="bg-white">
<div class="min-h-screen bg-white">
    <div class="max-w-3xl mx-auto px-6">
        <!-- Banner -->
        <div class="mt-8 rounded-t-lg overflow-hidden">
            <img src="/images/banner.jpg" alt="Banner" class="w-full h-auto">
        </div>

        <!-- Main Content -->
        <div class="py-8">
        <h2 class="text-2xl font-semibold text-gray-800 mb-2">Version 3 for guests with spouse and children</h2>
        <p class="text-gray-600 mb-6">請填寫以下資料完成活動登記</p>

        <% if (typeof error !== 'undefined' && error) { %>
            <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-6">
                <%= error %>
            </div>
        <% } %>

        <form method="POST" action="/form3" id="form3" class="bg-white">
            <!-- Main Attendee Information -->
            <div class="mb-8">
                <h3 class="text-xl font-semibold text-gray-800 mb-4">Main Attendee Information</h3>
                
                <div class="space-y-6">
                    <!-- Surname -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            *Surname / 姓 <span class="text-red-500">*</span>
                        </label>
                        <input type="text" name="surname" required
                            placeholder="fill in the blank"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>

                    <!-- Given Name -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            *Given Name / 名 <span class="text-red-500">*</span>
                        </label>
                        <input type="text" name="givenName" required
                            placeholder="fill in the blank"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>

                    <!-- Chinese Name -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            Chinese Name / 中文姓名
                        </label>
                        <div class="grid grid-cols-12 gap-2">
                            <div class="col-span-6">
                                <input type="text" name="chineseSurname"
                                    placeholder="姓"
                                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div class="col-span-6">
                                <input type="text" name="chineseGivenName"
                                    placeholder="名"
                                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                        </div>
                    </div>

                    <!-- Title of Respect -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            *Title of Respect / 稱謂 <span class="text-red-500">*</span>
                        </label>
                        <select name="titleOfRespect" required
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <option value="">--- Please select ---</option>
                            <option value="Mr">Mr / 先生</option>
                            <option value="Mrs">Mrs / 太太</option>
                            <option value="Ms">Ms / 女士</option>
                            <option value="Miss">Miss / 小姐</option>
                        </select>
                    </div>

                    <!-- Company / Organization -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            Company / Organization / 公司 / 機構
                        </label>
                        <input type="text" name="company"
                            placeholder="fill in the blank"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>

                    <!-- Title -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            Title / 職銜
                        </label>
                        <input type="text" name="title"
                            placeholder="fill in the blank"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>

                    <!-- Mobile Country Code and Mobile -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            Mobile / 手提電話
                        </label>
                        <div class="grid grid-cols-12 gap-2">
                            <div class="col-span-3">
                                <select name="mobileCountryCode"
                                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <%- include('partials/country-codes') %>
                                </select>
                            </div>
                            <div class="col-span-9">
                                <input type="tel" name="mobile"
                                    placeholder="fill in the blank"
                                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                        </div>
                    </div>

                    <!-- Email -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            *Email / 電子郵件 <span class="text-red-500">*</span>
                        </label>
                        <input type="email" name="email" required
                            placeholder="fill in the blank"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>

                    <!-- Attend -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            *Attend / 出席 <span class="text-red-500">*</span>
                        </label>
                        <div class="flex gap-6">
                            <label class="flex items-center">
                                <input type="radio" name="attend" value="Yes" required class="mr-2">
                                <span>Yes / 出席</span>
                            </label>
                            <label class="flex items-center">
                                <input type="radio" name="attend" value="No" required class="mr-2">
                                <span>No / 不出席</span>
                            </label>
                        </div>
                    </div>

                    <!-- Food Allergy -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            Food Allergy (Please specify if any) / 食物敏感(如有請註明)
                        </label>
                        <input type="text" name="foodAllergy"
                            placeholder="fill in the blank"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                </div>
            </div>

            <!-- Spouse Information (Yellow Background) -->
            <div class="mb-8 p-6 bg-yellow-50 border border-yellow-200 rounded-lg">
                <h3 class="text-xl font-semibold text-gray-800 mb-4">With Spouse / 攜眷</h3>
                
                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                        With Spouse / 攜眷
                    </label>
                    <div class="flex gap-6">
                        <label class="flex items-center">
                            <input type="radio" name="withSpouse" value="Yes" required class="mr-2" onchange="toggleSpouseFields()">
                            <span>Yes / 是</span>
                        </label>
                        <label class="flex items-center">
                            <input type="radio" name="withSpouse" value="No" required class="mr-2" onchange="toggleSpouseFields()">
                            <span>No / 否</span>
                        </label>
                    </div>
                </div>

                <div id="spouseFields" class="space-y-6 hidden">
                    <!-- Spouse Surname -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            *Surname / 姓 <span class="text-red-500">*</span>
                        </label>
                        <input type="text" name="spouseSurname"
                            placeholder="fill in the blank"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>

                    <!-- Spouse Given Name -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            *Given Name / 名 <span class="text-red-500">*</span>
                        </label>
                        <input type="text" name="spouseGivenName"
                            placeholder="fill in the blank"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>

                    <!-- Spouse Chinese Name -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            Chinese Name / 中文姓名
                        </label>
                        <div class="grid grid-cols-12 gap-2">
                            <div class="col-span-6">
                                <input type="text" name="spouseChineseSurname"
                                    placeholder="姓"
                                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div class="col-span-6">
                                <input type="text" name="spouseChineseGivenName"
                                    placeholder="名"
                                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                        </div>
                    </div>

                    <!-- Spouse Title of Respect -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            *Title of Respect / 稱謂 <span class="text-red-500">*</span>
                        </label>
                        <select name="spouseTitleOfRespect"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <option value="">--- Please select ---</option>
                            <option value="Mr">Mr / 先生</option>
                            <option value="Mrs">Mrs / 太太</option>
                            <option value="Ms">Ms / 女士</option>
                            <option value="Miss">Miss / 小姐</option>
                        </select>
                    </div>

                    <!-- Spouse Mobile Country Code and Mobile -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            Mobile / 手提電話
                        </label>
                        <div class="grid grid-cols-12 gap-2">
                            <div class="col-span-3">
                                <select name="spouseMobileCountryCode"
                                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <%- include('partials/country-codes') %>
                                </select>
                            </div>
                            <div class="col-span-9">
                                <input type="tel" name="spouseMobile"
                                    placeholder="fill in the blank"
                                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                        </div>
                    </div>

                    <!-- Spouse Email -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            *#Email / 電子郵件 <span class="text-red-500">*</span>
                        </label>
                        <input type="email" name="spouseEmail"
                            placeholder="fill in the blank"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>

                    <!-- Spouse Food Allergy -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            Food Allergy (Please specify if any) / 食物敏感(如有請註明)
                        </label>
                        <input type="text" name="spouseFoodAllergy"
                            placeholder="fill in the blank"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                </div>
            </div>

            <!-- Children Information -->
            <div class="mb-8 p-6 bg-blue-50 border border-blue-200 rounded-lg">
                <h3 class="text-xl font-semibold text-gray-800 mb-4">With Children / 攜同子女</h3>
                
                <!-- Step 1: 是否攜同子女 -->
                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                        With Children / 攜同子女
                    </label>
                    <div class="flex gap-6">
                        <label class="flex items-center">
                            <input type="radio" name="withChildren" value="Yes" required class="mr-2" onchange="toggleChildrenSection()">
                            <span>Yes / 是</span>
                        </label>
                        <label class="flex items-center">
                            <input type="radio" name="withChildren" value="No" required class="mr-2" onchange="toggleChildrenSection()">
                            <span>No / 否</span>
                        </label>
                    </div>
                </div>

                <!-- Step 2: 攜同子女數目 -->
                <div id="numberOfChildrenSection" class="mb-6 hidden">
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                        Number of Children / 攜同子女數目
                    </label>
                    <div class="flex gap-6">
                        <label class="flex items-center">
                            <input type="radio" name="numberOfChildren" value="1" class="mr-2" onchange="toggleChildrenFields()">
                            <span>1</span>
                        </label>
                        <label class="flex items-center">
                            <input type="radio" name="numberOfChildren" value="2" class="mr-2" onchange="toggleChildrenFields()">
                            <span>2</span>
                        </label>
                    </div>
                </div>

                <!-- Child 1 Information -->
                <div id="child1Fields" class="space-y-6 hidden">
                    <h4 class="text-lg font-semibold text-gray-800 mb-4">Child 1 / 子女(1)</h4>
                    
                    <!-- Child 1 Surname -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            *Surname / 姓 <span class="text-red-500">*</span>
                        </label>
                        <input type="text" name="child1Surname"
                            placeholder="fill in the blank"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>

                    <!-- Child 1 Given Name -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            *Given Name / 名 <span class="text-red-500">*</span>
                        </label>
                        <input type="text" name="child1GivenName"
                            placeholder="fill in the blank"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>

                    <!-- Child 1 Chinese Name -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            Chinese Name / 中文姓名
                        </label>
                        <div class="grid grid-cols-12 gap-2">
                            <div class="col-span-6">
                                <input type="text" name="child1ChineseSurname"
                                    placeholder="姓"
                                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div class="col-span-6">
                                <input type="text" name="child1ChineseGivenName"
                                    placeholder="名"
                                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                        </div>
                    </div>

                    <!-- Child 1 Title of Respect -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            *Title of Respect / 稱謂 <span class="text-red-500">*</span>
                        </label>
                        <select name="child1TitleOfRespect"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <option value="">--- Please select ---</option>
                            <option value="Mr">Mr / 先生</option>
                            <option value="Mrs">Mrs / 太太</option>
                            <option value="Ms">Ms / 女士</option>
                            <option value="Miss">Miss / 小姐</option>
                        </select>
                    </div>

                    <!-- Child 1 Mobile Country Code and Mobile -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            Mobile / 手提電話
                        </label>
                        <div class="grid grid-cols-12 gap-2">
                            <div class="col-span-3">
                                <select name="child1MobileCountryCode"
                                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <%- include('partials/country-codes') %>
                                </select>
                            </div>
                            <div class="col-span-9">
                                <input type="tel" name="child1Mobile"
                                    placeholder="fill in the blank"
                                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                        </div>
                    </div>

                    <!-- Child 1 Email -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            *#Email / 電子郵件 <span class="text-red-500">*</span>
                        </label>
                        <input type="email" name="child1Email"
                            placeholder="fill in the blank"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>

                    <!-- Child 1 Food Allergy -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            Food Allergy (Please specify if any) / 食物敏感(如有請註明)
                        </label>
                        <input type="text" name="child1FoodAllergy"
                            placeholder="fill in the blank"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                </div>

                <!-- Child 2 Information -->
                <div id="child2Fields" class="space-y-6 hidden mt-6">
                    <h4 class="text-lg font-semibold text-gray-800 mb-4">Child 2 / 子女(2)</h4>
                    
                    <!-- Child 2 Surname -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            *Surname / 姓 <span class="text-red-500">*</span>
                        </label>
                        <input type="text" name="child2Surname"
                            placeholder="fill in the blank"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>

                    <!-- Child 2 Given Name -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            *Given Name / 名 <span class="text-red-500">*</span>
                        </label>
                        <input type="text" name="child2GivenName"
                            placeholder="fill in the blank"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>

                    <!-- Child 2 Chinese Name -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            Chinese Name / 中文姓名
                        </label>
                        <div class="grid grid-cols-12 gap-2">
                            <div class="col-span-6">
                                <input type="text" name="child2ChineseSurname"
                                    placeholder="姓"
                                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div class="col-span-6">
                                <input type="text" name="child2ChineseGivenName"
                                    placeholder="名"
                                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                        </div>
                    </div>

                    <!-- Child 2 Title of Respect -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            *Title of Respect / 稱謂 <span class="text-red-500">*</span>
                        </label>
                        <select name="child2TitleOfRespect"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <option value="">--- Please select ---</option>
                            <option value="Mr">Mr / 先生</option>
                            <option value="Mrs">Mrs / 太太</option>
                            <option value="Ms">Ms / 女士</option>
                            <option value="Miss">Miss / 小姐</option>
                        </select>
                    </div>

                    <!-- Child 2 Mobile Country Code and Mobile -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            Mobile / 手提電話
                        </label>
                        <div class="grid grid-cols-12 gap-2">
                            <div class="col-span-3">
                                <select name="child2MobileCountryCode"
                                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <%- include('partials/country-codes') %>
                                </select>
                            </div>
                            <div class="col-span-9">
                                <input type="tel" name="child2Mobile"
                                    placeholder="fill in the blank"
                                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                        </div>
                    </div>

                    <!-- Child 2 Email -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            *#Email / 電子郵件 <span class="text-red-500">*</span>
                        </label>
                        <input type="email" name="child2Email"
                            placeholder="fill in the blank"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>

                    <!-- Child 2 Food Allergy -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            Food Allergy (Please specify if any) / 食物敏感(如有請註明)
                        </label>
                        <input type="text" name="child2FoodAllergy"
                            placeholder="fill in the blank"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                </div>
            </div>

            <!-- Important Notes -->
            <div class="mb-6 text-sm text-gray-600">
                <p>*Items must be provided / 必須提供</p>
                <p>#All attendees must register with distinct email addresses / 所有出席者的電郵地址必須各不相同</p>
            </div>

            <!-- Privacy Policy -->
            <div class="mb-8 p-4 bg-gray-50 rounded-lg">
                <div class="mb-4">
                    <p class="text-sm text-gray-700 mb-2">
                        By submitting this form, you are deemed to have agreed that this platform and The Hong Kong Jockey Club may collect and use the relevant personal data, and have read and accepted The Hong Kong Jockey Club's Privacy Policy Statement available at 
                        <a href="https://www.hkjc.com/home/english/corporate/corp_privacy.aspx" target="_blank" class="text-blue-600 hover:underline">https://www.hkjc.com/home/english/corporate/corp_privacy.aspx</a>. 
                        If you provide any personal data of any third party, you are deemed to have obtained authorisation to provide and allow this platform and The Hong Kong Jockey Club to collect and use the relevant personal data. Personal data may also be disclosed to third party services providers of this platform and The Hong Kong Jockey Club for the purposes of organising the event.
                    </p>
                    <p class="text-sm text-gray-700">
                        如閣下回覆此表格,將被視為已同意本平台及香港賽馬會收集及使用有關個人資料,並已閱讀及同意香港賽馬會載於下述網址的私隱條款: 
                        <a href="https://www.hkjc.com/home/chinese/corporate/corp_privacy.aspx" target="_blank" class="text-blue-600 hover:underline">https://www.hkjc.com/home/chinese/corporate/corp_privacy.aspx</a>. 
                        如閣下提供他人的個人資料,閣下將被視為已取得足夠授權提供及容許本平台及香港賽馬會收集及使用有關個人資料。個人資料可能會提供予本平台及香港賽馬會的第三方服務供應商,以作活動安排之用。
                    </p>
                </div>
                <div class="flex items-start">
                    <input type="checkbox" name="privacyConsent" id="privacyConsent" required
                        class="mt-1 mr-2 w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
                    <label for="privacyConsent" class="text-sm text-gray-700">
                        我已閱讀並同意上述隱私政策 <span class="text-red-500">*</span>
                    </label>
                </div>
            </div>

            <!-- Buttons -->
            <div class="flex gap-4 justify-end">
                <a href="/" class="px-6 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600">
                    返回
                </a>
                <button type="submit" class="px-6 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600">
                    提交
                </button>
            </div>
        </form>
        </div>
    </div>
</div>

<script>
function toggleSpouseFields() {
    const withSpouse = document.querySelector('input[name="withSpouse"]:checked');
    const spouseFields = document.getElementById('spouseFields');
    const spouseInputs = spouseFields.querySelectorAll('input, select');
    
    if (withSpouse && withSpouse.value === 'Yes') {
        spouseFields.classList.remove('hidden');
        spouseInputs.forEach(input => {
            if (input.name.includes('Surname') || input.name.includes('GivenName') || 
                input.name.includes('TitleOfRespect') || input.name.includes('Email')) {
                input.setAttribute('required', 'required');
            }
        });
    } else {
        spouseFields.classList.add('hidden');
        spouseInputs.forEach(input => {
            input.removeAttribute('required');
            input.value = '';
        });
    }
}

function toggleChildrenSection() {
    const withChildren = document.querySelector('input[name="withChildren"]:checked');
    const numberOfChildrenSection = document.getElementById('numberOfChildrenSection');
    const child1Fields = document.getElementById('child1Fields');
    const child2Fields = document.getElementById('child2Fields');
    
    if (withChildren && withChildren.value === 'Yes') {
        numberOfChildrenSection.classList.remove('hidden');
    } else {
        numberOfChildrenSection.classList.add('hidden');
        child1Fields.classList.add('hidden');
        child2Fields.classList.add('hidden');
        // 清除所有小孩欄位
        clearChildrenFields();
        // 清除選擇
        document.querySelectorAll('input[name="numberOfChildren"]').forEach(radio => {
            radio.checked = false;
        });
    }
}

function toggleChildrenFields() {
    const numberOfChildren = document.querySelector('input[name="numberOfChildren"]:checked');
    const child1Fields = document.getElementById('child1Fields');
    const child2Fields = document.getElementById('child2Fields');
    
    if (!numberOfChildren) {
        child1Fields.classList.add('hidden');
        child2Fields.classList.add('hidden');
        clearChildrenFields();
        return;
    }
    
    const count = parseInt(numberOfChildren.value);
    
    if (count >= 1) {
        child1Fields.classList.remove('hidden');
        setRequiredFields(child1Fields, true);
    } else {
        child1Fields.classList.add('hidden');
        setRequiredFields(child1Fields, false);
        clearChildFields(child1Fields);
    }
    
    if (count >= 2) {
        child2Fields.classList.remove('hidden');
        setRequiredFields(child2Fields, true);
    } else {
        child2Fields.classList.add('hidden');
        setRequiredFields(child2Fields, false);
        clearChildFields(child2Fields);
    }
}

function setRequiredFields(container, required) {
    const inputs = container.querySelectorAll('input, select');
    inputs.forEach(input => {
        if (input.name.includes('Surname') || input.name.includes('GivenName') || 
            input.name.includes('TitleOfRespect') || input.name.includes('Email')) {
            if (required) {
                input.setAttribute('required', 'required');
            } else {
                input.removeAttribute('required');
            }
        }
    });
}

function clearChildFields(container) {
    const inputs = container.querySelectorAll('input, select');
    inputs.forEach(input => {
        input.value = '';
    });
}

function clearChildrenFields() {
    clearChildFields(document.getElementById('child1Fields'));
    clearChildFields(document.getElementById('child2Fields'));
}

// 表單提交前驗證
document.getElementById('form3').addEventListener('submit', function(e) {
    const emails = [document.querySelector('input[name="email"]').value.toLowerCase()];
    
    // 收集所有 email
    const withSpouse = document.querySelector('input[name="withSpouse"]:checked');
    if (withSpouse && withSpouse.value === 'Yes') {
        const spouseEmail = document.querySelector('input[name="spouseEmail"]').value.toLowerCase();
        if (spouseEmail) emails.push(spouseEmail);
    }
    
    const withChildren = document.querySelector('input[name="withChildren"]:checked');
    const numberOfChildren = document.querySelector('input[name="numberOfChildren"]:checked');
    
    if (withChildren && withChildren.value === 'Yes' && numberOfChildren) {
        const count = parseInt(numberOfChildren.value);
        
        if (count >= 1) {
            const child1Email = document.querySelector('input[name="child1Email"]');
            if (child1Email && child1Email.value) {
                emails.push(child1Email.value.toLowerCase());
            }
        }
        
        if (count >= 2) {
            const child2Email = document.querySelector('input[name="child2Email"]');
            if (child2Email && child2Email.value) {
                emails.push(child2Email.value.toLowerCase());
            }
        }
    }
    
    // 檢查 email 唯一性
    const uniqueEmails = [...new Set(emails)];
    if (emails.length !== uniqueEmails.length) {
        e.preventDefault();
        alert('所有出席者的電郵地址必須各不相同');
        return false;
    }
});
</script>
</body>
</html>
